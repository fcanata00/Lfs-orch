# ======================================================================
#  Porg Configuration File
#  Global configuration for all modules (builder, deps, db, remove, etc.)
# ======================================================================

# ────────────────────────────────────────────────────────────────
# 🏗️  Base Directories
# ────────────────────────────────────────────────────────────────
PORTS_DIR="/usr/ports"                  # Local repository of metafiles (YAML)
BUILD_DIR="/mnt/lfs/build"              # Temporary build root
CHROOT_DIR="/mnt/lfs"                   # Safe isolated environment (bubblewrap)
DESTDIR_BASE="/mnt/lfs/dest"            # fakeroot DESTDIR during installation
PKG_BACKUP_DIR="/var/backups/porg"      # Backup of old packages before upgrade

# ────────────────────────────────────────────────────────────────
# 🧱  System Paths
# ────────────────────────────────────────────────────────────────
DB_DIR="/var/lib/porg/db"               # Package database
LOG_DIR="/var/log/porg"                 # General log directory
HOOKS_DIR="/usr/ports/hooks"            # Global hook overrides (optional)
AUDIT_DIR="/var/log/porg/audit"         # Audit logs
RESOLVE_CACHE="/var/lib/porg/resolve"   # Dependency resolution cache

# ────────────────────────────────────────────────────────────────
# ⚙️  Build Configuration
# ────────────────────────────────────────────────────────────────
USE_CHROOT=true                         # Always build inside bubblewrap chroot
USE_FAKEROOT=true                       # Install in fakeroot before merging
KEEP_BUILD_DIR=false                    # Clean build dir after successful build
PARALLEL_BUILDS=true                    # Enable make -j$(nproc)
DEFAULT_MAKEFLAGS="-j$(nproc)"
STRIP_BINARIES=true                     # Strip binaries after install
ALLOW_BOOTSTRAP=true                    # Allow bootstrap builds (toolchain)
ENABLE_RESUME=true                      # Resume failed builds automatically
TIMEOUT_DEFAULT=7200                    # Max seconds per build (2h)
RESOURCE_LIMIT_CPU=90                   # % CPU limit for processes
RESOURCE_LIMIT_MEM=90                   # % Memory limit

# ────────────────────────────────────────────────────────────────
# 🧩  Dependency and Revdep
# ────────────────────────────────────────────────────────────────
DEPS_PY="/usr/lib/porg/deps.py"         # Python dependency resolver path
AUTO_DEP_CLEAN=true                     # Automatically remove orphaned deps
AUTO_REVDEP_REBUILD=true                # Rebuild broken reverse deps

# ────────────────────────────────────────────────────────────────
# 🧹  Remove / Clean
# ────────────────────────────────────────────────────────────────
ALLOW_FORCE_REMOVE=true                 # Allow --force removal
AUTO_HOOK_REMOVE=true                   # Run hooks on remove
REMOVE_ORPHANS_AFTER_FORCE=true         # Run depclean+revdep after forced remove

# ────────────────────────────────────────────────────────────────
# 🔄  Upgrade / Sync Configuration
# ────────────────────────────────────────────────────────────────
ALLOW_UPGRADE=true                      # Enable upgrades
BACKUP_BEFORE_UPGRADE=true              # Backup old version before upgrade
CONTINUE_ON_FAIL=true                   # Resume upgrade chain if one fails
SYNC_ON_START=true                      # Automatically sync metafiles before build
GIT_REPO="https://github.com/fernando/porg-ports.git"
GIT_BRANCH="main"
SYNC_INTERVAL="daily"                   # daily|weekly|manual
GIT_SSL_VERIFY=true

# ────────────────────────────────────────────────────────────────
# 🌈  Logging Configuration
# ────────────────────────────────────────────────────────────────
LOG_COLOR=true                          # Enable colorized logs
LOG_TIMESTAMP=true                      # Show timestamps in logs
LOG_LEVEL="INFO"                        # INFO|DEBUG|WARN|ERROR
QUIET_MODE_DEFAULT=false                # Default --quiet mode
LOG_ROTATE_DAYS=14                      # Automatically delete logs older than X days
SHOW_LOADAVG=true                       # Display load average during build
SHOW_CPU_MEM=true                       # Show CPU/mem usage in real-time

# ────────────────────────────────────────────────────────────────
# 🧪  Audit and Security
# ────────────────────────────────────────────────────────────────
ENABLE_AUDIT=true                       # Enable system audit mode
AUTO_FIX_PROBLEMS=true                  # Automatically fix broken libs/links
AUDIT_INTERVAL="weekly"
AUDIT_VULN_SOURCES=(
  "https://cve.circl.lu/api/last"
  "https://security-tracker.debian.org/tracker/source-package"
)
LIBCHECK_TOOLS=("ldd" "scanelf" "readelf")
AUDIT_SEVERITY_THRESHOLD="medium"       # low|medium|high

# ────────────────────────────────────────────────────────────────
# 📦  Packaging / Compression
# ────────────────────────────────────────────────────────────────
PKG_FORMAT="tar.zst"                    # tar.xz | tar.zst | tar.gz
PKG_COMPRESS_LEVEL=19
PKG_OUTPUT_DIR="/var/cache/porg/packages"

# ────────────────────────────────────────────────────────────────
# 🔒  Security / Sandbox
# ────────────────────────────────────────────────────────────────
BWRAP_BIN="/usr/bin/bwrap"
CHROOT_ISOLATE_NET=false                # Disable network inside chroot
CHROOT_MOUNT_DEV=true                   # Mount /dev inside chroot
CHROOT_MOUNT_PROC=true                  # Mount /proc inside chroot
CHROOT_MOUNT_SYS=true                   # Mount /sys inside chroot

# ────────────────────────────────────────────────────────────────
# 🌍  Network and Mirrors
# ────────────────────────────────────────────────────────────────
NET_RETRIES=3
NET_TIMEOUT=60
DOWNLOAD_DIR="/var/cache/porg/sources"
MIRRORS=(
  "https://ftp.gnu.org/gnu"
  "https://mirror.example.org"
)
GPG_VERIFY=true
CHECKSUM_VERIFY=true

# ────────────────────────────────────────────────────────────────
# 💾  Database and Manifest
# ────────────────────────────────────────────────────────────────
MANIFEST_CHECKSUM=true
DB_BACKUP_ON_CHANGE=true
DB_BACKUP_DIR="/var/backups/porg/db"

# ────────────────────────────────────────────────────────────────
# 🧠  Advanced / Developer
# ────────────────────────────────────────────────────────────────
DEBUG_MODE=false
SHOW_TIMING=true
SHOW_PROGRESS=true
FORCE_REBUILD=false
VERBOSE_PARSER=false

# ────────────────────────────────────────────────────────────────
# 🧩  Integration with other modules
# ────────────────────────────────────────────────────────────────
LOGGER_MODULE="/usr/lib/porg/porg_logger.sh"
DB_MODULE="/usr/lib/porg/porg_db.sh"
REMOVE_MODULE="/usr/lib/porg/porg_remove.sh"
RESOLVE_MODULE="/usr/lib/porg/resolve.sh"
UPGRADE_MODULE="/usr/lib/porg/porg_upgrade.sh"
AUDIT_MODULE="/usr/lib/porg/porg_audit.sh"

# ────────────────────────────────────────────────────────────────
# 🧩  Miscellaneous
# ────────────────────────────────────────────────────────────────
TMP_DIR="/tmp/porg"
CACHE_DIR="/var/cache/porg"
LOCK_DIR="/run/lock/porg"
SHELL="/bin/bash"

# End of file
